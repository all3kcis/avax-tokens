<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<title>Avax Tokens list</title>
	<!-- Favicon-->
	<link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
	<!-- Font Awesome icons (free version)-->
	<script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
	<!-- Google fonts-->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
	<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
	<!-- Core theme CSS (includes Bootstrap)-->
	<link href="css/styles.css" rel="stylesheet" />
</head>
<body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="#page-top">Avax Tokens</a>
                <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#assets">Assets</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#lists">Lists</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="" onclick="connectMetamask()"><img src="assets/MetaMask_Fox.svg" alt="Metamask" width="35px"></a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead text-white text-center  assets" id="assets">
            <div class="container d-flex align-items-center flex-column">

				<p><form class="form-inline">
					<input type="q" class="form-control" id="q" placeholder="XAVA">
				</form></p>
	            <table class="table table-borderless" id="tokens">
					<thead>
						<tr>
							<th scope="col">#</th>
							<th scope="col">Symbol</th>
							<th scope="col">Name</th>
							<th scope="col">Address</th>
							<th scope="col"></th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
            </div>
        </header>
        <!-- Portfolio Section-->
        <section class="page-section lists" id="lists">
            <div class="container">
                <!-- Portfolio Section Heading-->
                <p><h3 class="page-section-heading text-center text-uppercase text-secondary mb-0">Lists</h2></p>
                <!-- Portfolio Grid Items-->
                <div class="row justify-content-center">
                    <div class="col-md-10">
                    	<table class="table table-borderless" id="lists">
						<thead>
							<tr>
								<th scope="col">#</th>
								<th scope="col">Name</th>
								<th scope="col">Version</th>
								<th scope="col">Update</th>
								<th scope="col">Url</th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
                    </div>
                </div>
            </div>
        </section>
       
        <!-- Copyright Section-->
        <div class="copyright py-4 text-center text-white">
            <div class="container">
                <small>
                    Made with ❤️ by @all3kcis - 
                    <!-- This script automatically adds the current year to your website footer-->
                    <!-- (credit: https://updateyourfooter.com/)-->
                    <script>
                        document.write(new Date().getFullYear());
                    </script>

                    - <a href="https://github.com/all3kcis/avax-tokens">Contribute</a> - Credit : Thème <a href="https://github.com/startbootstrap/startbootstrap-freelancer" target="_blank">startbootstrap-freelancer</a>
                </small>
            </div>
        </div>
        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
        <div class="scroll-to-top d-lg-none position-fixed">
            <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i class="fa fa-chevron-up"></i></a>
        </div>
        
        <!-- Bootstrap core JS-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    	<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

        <script>

    	var lists = [
    		'https://raw.githubusercontent.com/pangolindex/tokenlists/main/top15.tokenlist.json',
			'https://raw.githubusercontent.com/pangolindex/tokenlists/main/defi.tokenlist.json',
			'https://raw.githubusercontent.com/pangolindex/tokenlists/main/aeb.tokenlist.json',
			'https://raw.githubusercontent.com/pangolindex/tokenlists/main/stablecoin.tokenlist.json',
			'https://raw.githubusercontent.com/baguette-exchange/contracts/master/tokenlist/baguette.tokenlist.json',
			'https://raw.githubusercontent.com/elkfinance/tokens/main/avax.tokenlist.json',
			// Todo Custom list
		]

		var tokens = {}
		
		function addList(name, version, timestamp, img, url){


			th = $('<th>').attr('scope','row').html('<img width="35px" src="'+img+'" alt="'+name+'">')
			td1 = $('<td>').addClass('bold').html(name)
			td2 = $('<td>').html(version)
			td3 = $('<td>').html(timestamp)
			td4 = $('<td>').html('<a href="'+url+'" target="_blank">Github</a>')
			tr = $('<tr>').append(th)
			tr.append(td1)
			tr.append(td2)
			tr.append(td3)
			tr.append(td4)
			$('#lists tbody').append(tr)
		}

		function addToken(name, symbol, img, address){

			th = $('<th>').attr('scope','row').html('<img width="35px" src="'+img+'" alt="'+symbol+'">')
			td1 = $('<td>').addClass('bold').html(name)
			td2 = $('<td>').addClass('bold').html(symbol)
			td3 = $('<td>').html('<a href="https://cchain.explorer.avax.network/tokens/'+address+'/token-holders">'+address+'</a>')
			td4 = $('<td>').html('<button type="submit" class="btn btn-secondary" onClick="addTokenToMetaMask(\''+address+'\')">Add</button>')
			tr = $('<tr>').append(th)
			tr.append(td1)
			tr.append(td2)
			tr.append(td3)
			tr.append(td4)
			$('#tokens tbody').append(tr)
		}

		function refreshTokensList(text){
			var tmp_tokens = {}
			let re = RegExp(text, 'igd');

			for (const [address, token ] of Object.entries(tokens)) {
				if( re.exec(token.name) !== null ||  re.exec(token.symbol) !== null){
					tmp_tokens[address]= token
				}
			}
			$('#tokens tbody').empty('')
			for (const [address, token ] of Object.entries(tmp_tokens)) {
				addToken(token.name, token.symbol, token.img, token.address)
			}
		}

		async function connectMetamask(){
			if (window.ethereum) {
		        window.web3 = new Web3(ethereum);
		        try {
		          await ethereum.enable();
		        } catch (err) {
		          console.log('User denied account access', err)
		        }
		    } else if (window.web3) {
		        window.web3 = new Web3(web3.currentProvider)
		    } else {
		       console.log('No Metamask (or other Web3 Provider) installed')
		    }
		}

		async function addTokenToMetaMask(address){
			await connectMetamask()
			console.log(tokens, address, tokens[address])
			try {
			  // wasAdded is a boolean. Like any RPC method, an error may be thrown.
			  const wasAdded = await ethereum.request({
			    method: 'wallet_watchAsset',
			    params: {
			      type: 'ERC20', // Initially only supports ERC20, but eventually more!
			      options: {
			        address: address, // The address that the token is at.
			        symbol: tokens[address].symbol, // A ticker symbol or shorthand, up to 5 chars.
			        decimals: tokens[address].decimals, // The number of decimals in the token
			        image: tokens[address].img, // A string url of the token logo
			      },
			    },
			  });

			  if (wasAdded) {
			    console.log('Thanks for your interest!');
			  } else {
			    console.log('Your loss!');
			  }
			} catch (error) {
			  console.log(error);
			}
		}

		$("#q").keyup(function() {
			refreshTokensList($(this).val())
		});


		$( document ).ready(async function() {
		
			$.each(lists, function( index, url ) {
				$.ajax({
					url : url,
					type : "get",
					async: false,
					success : function(data) {
						var list = jQuery.parseJSON( data );
						addList(list.name, list.version.major+'.'+list.version.minor+'.'+list.version.patch, list.timestamp, list.logoURI, url)
						$.each(list.tokens, function( index, token ) {
							if(typeof tokens[token.address.toLowerCase()] == 'undefined'){
								tokens[token.address.toLowerCase()] = {
									address:token.address.toLowerCase(),
									chainId:token.chainId,
									decimals:token.decimals,
									name:token.name,
									symbol:token.symbol,
									img:token.logoURI,
								}
							}
							
						})
					},
					error: function() {
						console.log( "error" );
					}
				});
			});


			i=0
			for (const [address, token ] of Object.entries(tokens)) {
				if(i>=15) return false;
				addToken(token.name, token.symbol, token.img, token.address)
				i++
			}


			
			
		});

	</script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-6K80ZB2LGM"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-6K80ZB2LGM');
	</script>
</body>
</body>
</html>